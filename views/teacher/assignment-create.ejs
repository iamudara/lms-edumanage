<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %> - LMS EduManage</title>
  <link rel="stylesheet" href="/css/output.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="stylesheet" href="/css/teacher-theme.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <%- include('../shared/navbar') %>

  <div class="container mx-auto px-4 py-4 sm:py-8">
    <!-- Breadcrumb -->
    <div class="text-sm breadcrumbs mb-4 sm:mb-6">
      <ul>
        <li class="hidden sm:inline"><a href="/teacher/dashboard"><i class="fas fa-home mr-1"></i>Dashboard</a></li>
        <li><a href="/teacher/courses"><i class="fas fa-book mr-1"></i>Courses</a></li>
        <li><a href="/teacher/courses/<%= course.id %>"><%= course.code %></a></li>
        <li class="font-semibold">Create Assignment</li>
      </ul>
    </div>

    <!-- Page Header -->
    <div class="mb-6 sm:mb-8">
      <h1 class="text-2xl sm:text-3xl font-bold mb-2">
        <i class="fas fa-tasks mr-2"></i>Create Assignment
      </h1>
      <p class="text-sm sm:text-base text-base-content/70">
        <%= course.code %> - <%= course.title %>
      </p>
    </div>

    <!-- Success/Error Messages -->
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="alert alert-error mb-6">
        <i class="fas fa-exclamation-circle"></i>
        <span><%= error %></span>
      </div>
    <% } %>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Assignment Form (2/3 width) -->
      <div class="lg:col-span-2">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-6">
              <i class="fas fa-edit mr-2"></i>Assignment Details
            </h2>

            <form action="/teacher/courses/<%= course.id %>/assignments" method="POST" id="assignmentForm" enctype="multipart/form-data">
              <!-- Title -->
              <div class="form-control mb-4">
                <label class="label">
                  <span class="label-text font-semibold">
                    Title <span class="text-error">*</span>
                  </span>
                </label>
                <input 
                  type="text" 
                  name="title" 
                  placeholder="e.g., Week 1 Programming Assignment" 
                  class="input input-bordered w-full"
                  required
                  maxlength="200"
                >
                <label class="label">
                  <span class="label-text-alt text-base-content/60">Maximum 200 characters</span>
                </label>
              </div>

              <!-- Description -->
              <div class="form-control mb-4">
                <label class="label">
                  <span class="label-text font-semibold">Description</span>
                </label>
                <textarea 
                  name="description" 
                  rows="6"
                  placeholder="Provide detailed instructions for the assignment..."
                  class="textarea textarea-bordered w-full"
                ></textarea>
                <label class="label">
                  <span class="label-text-alt text-base-content/60">Optional - Provide instructions, requirements, or guidelines</span>
                </label>
              </div>

              <!-- Deadline -->
              <div class="form-control mb-6">
                <label class="label">
                  <span class="label-text font-semibold">
                    Deadline <span class="text-error">*</span>
                  </span>
                </label>
                <input 
                  type="datetime-local" 
                  name="deadline" 
                  class="input input-bordered w-full"
                  required
                  id="deadlineInput"
                >
                <label class="label">
                  <span class="label-text-alt text-base-content/60">
                    Select a future date and time. Students must submit before this deadline.
                  </span>
                </label>
              </div>

              <!-- Assignment Materials Section -->
              <div class="divider">Assignment Materials (Optional)</div>
              
              <div class="alert alert-info mb-4">
                <i class="fas fa-info-circle"></i>
                <span>Attach files or links to help students with this assignment (e.g., instructions PDF, reference materials, example code)</span>
              </div>

              <!-- File Uploads -->
              <div class="form-control mb-4">
                <label class="label">
                  <span class="label-text font-semibold">
                    <i class="fas fa-file-upload mr-2"></i>Upload Files
                  </span>
                </label>
                <div id="fileUploadsContainer" class="space-y-3">
                  <div class="file-upload-row">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                      <div class="md:col-span-2">
                        <input 
                          type="file" 
                          name="materials" 
                          class="file-input file-input-bordered file-input-primary w-full" 
                          accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.zip"
                        >
                      </div>
                      <div>
                        <input 
                          type="text" 
                          name="material_titles[]" 
                          placeholder="File title (optional)"
                          class="input input-bordered w-full"
                        >
                      </div>
                    </div>
                  </div>
                </div>
                <button type="button" class="btn btn-sm btn-outline mt-2" onclick="addFileUpload()">
                  <i class="fas fa-plus mr-2"></i>Add Another File
                </button>
                <label class="label">
                  <span class="label-text-alt text-base-content/60">Supported: PDF, DOC, DOCX, PPT, PPTX, TXT, ZIP (Max 10MB each)</span>
                </label>
              </div>

              <!-- URL Links -->
              <div class="form-control mb-6">
                <label class="label">
                  <span class="label-text font-semibold">
                    <i class="fas fa-link mr-2"></i>Add Links
                  </span>
                </label>
                <div id="urlLinksContainer" class="space-y-3">
                  <div class="url-link-row">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                      <div class="md:col-span-2">
                        <input 
                          type="url" 
                          name="material_urls[]" 
                          placeholder="https://example.com/resource"
                          class="input input-bordered w-full"
                        >
                      </div>
                      <div>
                        <input 
                          type="text" 
                          name="url_titles[]" 
                          placeholder="Link title (optional)"
                          class="input input-bordered w-full"
                        >
                      </div>
                    </div>
                  </div>
                </div>
                <button type="button" class="btn btn-sm btn-outline mt-2" onclick="addUrlLink()">
                  <i class="fas fa-plus mr-2"></i>Add Another Link
                </button>
                <label class="label">
                  <span class="label-text-alt text-base-content/60">External resources, documentation, tutorials, etc.</span>
                </label>
              </div>

              <div class="divider"></div>

              <!-- Submit Buttons -->
              <div class="flex gap-3">
                <button type="submit" class="btn btn-primary" style="padding-left: 1.5rem; padding-right: 1.5rem;">
                  <i class="fas fa-save mr-2"></i>Create Assignment
                </button>
                <a href="/teacher/courses/<%= course.id %>" class="btn btn-outline" style="background-color: #ef4444; color: white; border-color: #ef4444; padding-left: 1.5rem; padding-right: 1.5rem;">
                  <i class="fas fa-times mr-2"></i>Cancel
                </a>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Guidelines Sidebar (1/3 width) -->
      <div class="lg:col-span-1">
        <!-- Tips Card -->
        <div class="card bg-base-100 shadow-xl mb-6">
          <div class="card-body">
            <h3 class="font-semibold text-lg mb-3">
              <i class="fas fa-lightbulb mr-2 text-warning"></i>Tips
            </h3>
            <ul class="text-sm space-y-2 text-base-content/80">
              <li class="flex items-start gap-2">
                <i class="fas fa-check-circle text-success mt-1"></i>
                <span>Use clear, descriptive titles</span>
              </li>
              <li class="flex items-start gap-2">
                <i class="fas fa-check-circle text-success mt-1"></i>
                <span>Provide detailed instructions in the description</span>
              </li>
              <li class="flex items-start gap-2">
                <i class="fas fa-check-circle text-success mt-1"></i>
                <span>Set realistic deadlines</span>
              </li>
              <li class="flex items-start gap-2">
                <i class="fas fa-check-circle text-success mt-1"></i>
                <span>Deadline must be in the future</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Important Notes Card -->
        <div class="card bg-base-200 shadow-xl">
          <div class="card-body">
            <h3 class="font-semibold text-lg mb-3">
              <i class="fas fa-exclamation-triangle mr-2 text-warning"></i>Important
            </h3>
            <ul class="text-sm space-y-2 text-base-content/70">
              <li class="flex items-start gap-2">
                <i class="fas fa-info-circle text-info mt-1"></i>
                <span>Students cannot submit after the deadline</span>
              </li>
              <li class="flex items-start gap-2">
                <i class="fas fa-info-circle text-info mt-1"></i>
                <span>You can edit the deadline later if needed</span>
              </li>
              <li class="flex items-start gap-2">
                <i class="fas fa-info-circle text-info mt-1"></i>
                <span>All students enrolled in this course will see the assignment</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%- include('../shared/footer') %>

  <script>
    // Add file upload row
    function addFileUpload() {
      const container = document.getElementById('fileUploadsContainer');
      const newRow = document.createElement('div');
      newRow.className = 'file-upload-row';
      newRow.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <div class="md:col-span-2">
            <input 
              type="file" 
              name="materials" 
              class="file-input file-input-bordered file-input-primary w-full" 
              accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.zip"
            >
          </div>
          <div class="flex gap-2">
            <input 
              type="text" 
              name="material_titles[]" 
              placeholder="File title (optional)"
              class="input input-bordered w-full"
            >
            <button type="button" class="btn btn-error btn-sm" onclick="this.closest('.file-upload-row').remove()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      `;
      container.appendChild(newRow);
    }

    // Add URL link row
    function addUrlLink() {
      const container = document.getElementById('urlLinksContainer');
      const newRow = document.createElement('div');
      newRow.className = 'url-link-row';
      newRow.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <div class="md:col-span-2">
            <input 
              type="url" 
              name="material_urls[]" 
              placeholder="https://example.com/resource"
              class="input input-bordered w-full"
            >
          </div>
          <div class="flex gap-2">
            <input 
              type="text" 
              name="url_titles[]" 
              placeholder="Link title (optional)"
              class="input input-bordered w-full"
            >
            <button type="button" class="btn btn-error btn-sm" onclick="this.closest('.url-link-row').remove()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      `;
      container.appendChild(newRow);
    }
  
    // Set minimum datetime to current time
    document.addEventListener('DOMContentLoaded', function() {
      const deadlineInput = document.getElementById('deadlineInput');
      const now = new Date();
      
      // Add 10 minutes to current time as minimum
      now.setMinutes(now.getMinutes() + 10);
      
      // Format to YYYY-MM-DDTHH:MM
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      
      const minDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
      deadlineInput.min = minDateTime;
      
      // Set default value to 1 week from now
      const oneWeekLater = new Date();
      oneWeekLater.setDate(oneWeekLater.getDate() + 7);
      oneWeekLater.setHours(23, 59);
      
      const defaultYear = oneWeekLater.getFullYear();
      const defaultMonth = String(oneWeekLater.getMonth() + 1).padStart(2, '0');
      const defaultDay = String(oneWeekLater.getDate()).padStart(2, '0');
      const defaultHours = String(oneWeekLater.getHours()).padStart(2, '0');
      const defaultMinutes = String(oneWeekLater.getMinutes()).padStart(2, '0');
      
      deadlineInput.value = `${defaultYear}-${defaultMonth}-${defaultDay}T${defaultHours}:${defaultMinutes}`;
    });

    // Form validation
    document.getElementById('assignmentForm').addEventListener('submit', function(e) {
      const deadlineInput = document.getElementById('deadlineInput');
      const deadline = new Date(deadlineInput.value);
      const now = new Date();
      
      if (deadline <= now) {
        e.preventDefault();
        
        // Format the current date/time for user-friendly message
        const currentDateTime = now.toLocaleString('en-US', {
          month: '2-digit',
          day: '2-digit', 
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          hour12: true
        });
        
        alert(`Deadline must be in the future!\nCurrent time: ${currentDateTime}\nPlease select a date and time after now.`);
        return false;
      }
    });
  </script>
</body>
</html>
